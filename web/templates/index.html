{% extends "base.html" %}
{% block content %}
<h2 style="text-align:center; color:#1a73e8; margin-bottom:24px;">Dá»± Ä‘oÃ¡n Ä‘á»™ trá»… chuyáº¿n bay</h2>
        <h2>Dá»± Ä‘oÃ¡n Ä‘á»™ trá»… chuyáº¿n bay</h2>
        <form method="POST">
            <label>Chá»n cháº¿ Ä‘á»™ dá»± Ä‘oÃ¡n:</label>
            <select id="mode" name="mode" onchange="togglePrevFlight()">
                <option value="normal">Dá»± Ä‘oÃ¡n thÃ´ng thÆ°á»ng</option>
                <option value="prev_flight">Dá»± Ä‘oÃ¡n dá»±a trÃªn chuyáº¿n bay trÆ°á»›c</option>
            </select>

            <label>Thá»i gian bay dá»± kiáº¿n (phÃºt):</label>
            <input type="number" name="elapsed_time" min="1" required>

            <label>Thá»i gian khá»Ÿi hÃ nh:</label>
            <input type="datetime-local" name="departure_time" required>

            <label>Tail Number:</label>
            <input type="text" name="tail_number" maxlength="10" required>

            <label>Carrier Code:</label>
            <input type="text" name="carrier_code" maxlength="5" required>

            <label>Origin Airport:</label>
            <input type="text" name="origin_airport" maxlength="5" required>

            <label>Destination Airport:</label>
            <input type="text" name="destination_airport" maxlength="5" required>

            <div class="section-title">Dá»¯ liá»‡u thá»i tiáº¿t (sÃ¢n bay Ä‘i):</div>
            <label>Nhiá»‡t Ä‘á»™ (Â°C):</label>
            <input type="number" step="0.1" name="temp_x" required>
            <label>LÆ°á»£ng mÆ°a (mm):</label>
            <input type="number" step="0.1" name="precip_x" required>
            <label>Tá»‘c Ä‘á»™ giÃ³ (km/h):</label>
            <input type="number" step="0.1" name="wind_x" required>

            <div class="section-title">Dá»¯ liá»‡u thá»i tiáº¿t (sÃ¢n bay Ä‘áº¿n):</div>
            <label>Nhiá»‡t Ä‘á»™ (Â°C):</label>
            <input type="number" step="0.1" name="temp_y" required>
            <label>LÆ°á»£ng mÆ°a (mm):</label>
            <input type="number" step="0.1" name="precip_y" required>
            <label>Tá»‘c Ä‘á»™ giÃ³ (km/h):</label>
            <input type="number" step="0.1" name="wind_y" required>

            <div id="prev-flight-fields" style="display:none;">
                <div class="section-title">ThÃ´ng tin chuyáº¿n bay trÆ°á»›c Ä‘Ã³:</div>
                <label>Thá»i gian xuáº¥t phÃ¡t chuyáº¿n trÆ°á»›c:</label>
                <input type="datetime-local" name="prev_departure_time">
                <label>Thá»i gian Ä‘áº¿n chuyáº¿n trÆ°á»›c:</label>
                <input type="datetime-local" name="prev_arrival_time">
            </div>

            <label>Chá»n mÃ´ hÃ¬nh ML:</label>
            <select name="model" required>
                <option value="LinearRegression_model">Linear Regression</option>
                <option value="RandomForest_model">Random Forest</option>
                <option value="XGBoost_model">XGBoost</option>
                <option value="LightGBM_model">LightGBM</option>
            </select>

            <input type="submit" value="Dá»± Ä‘oÃ¡n">
        </form>

        {% if error %}
        <div class="result-box" style="background:#ffebee; color:#b71c1c; border-color:#ef9a9a;">
            âš ï¸ {{ error }}
        </div>
        {% endif %}

        {% if prediction %}
        <div class="result-box">
            â±ï¸ Dá»± Ä‘oÃ¡n Ä‘á»™ trá»…: {{ prediction }} phÃºt
        </div>
        {% endif %}

        {% if form_data and prediction %}
        <div class="result-box" style="background:#fffde7; color:#795548; border-color:#ffe082; text-align:left;">
            <b>ThÃ´ng tin chuyáº¿n bay vá»«a nháº­p:</b><br>
            Cháº¿ Ä‘á»™ dá»± Ä‘oÃ¡n: {{ form_data.mode }}<br>
            Thá»i gian bay dá»± kiáº¿n: {{ form_data.elapsed_time }} phÃºt<br>
            Thá»i gian khá»Ÿi hÃ nh: {{ form_data.departure_time|replace('T', ' ') }}<br>
            Tail Number: {{ form_data.tail_number }}<br>
            Carrier Code: {{ form_data.carrier_code }}<br>
            SÃ¢n bay Ä‘i: {{ form_data.origin_airport }}<br>
            SÃ¢n bay Ä‘áº¿n: {{ form_data.destination_airport }}<br>
            <b>Thá»i tiáº¿t sÃ¢n bay Ä‘i:</b>
            Nhiá»‡t Ä‘á»™: {{ form_data.temp_x }}Â°C, MÆ°a: {{ form_data.precip_x }}mm, GiÃ³: {{ form_data.wind_x }}km/h<br>
            <b>Thá»i tiáº¿t sÃ¢n bay Ä‘áº¿n:</b>
            Nhiá»‡t Ä‘á»™: {{ form_data.temp_y }}Â°C, MÆ°a: {{ form_data.precip_y }}mm, GiÃ³: {{ form_data.wind_y }}km/h<br>
            {% if form_data.mode == "prev_flight" %}
            <b>ThÃ´ng tin chuyáº¿n trÆ°á»›c:</b>
            Xuáº¥t phÃ¡t: {{ form_data.prev_departure_time|replace('T', ' ') }}<br>
            Äáº¿n nÆ¡i: {{ form_data.prev_arrival_time|replace('T', ' ') }}
            {% endif %}
            <br>MÃ´ hÃ¬nh ML: {{ form_data.model }}
        </div>
        {% endif %}

{% if prev_delay is not none %}
<div class="result-box" style="background:#e3f2fd; color:#0d47a1;">
    Äá»™ trá»… chuyáº¿n bay trÆ°á»›c: {{ prev_delay|round(2) }} phÃºt
</div>
{% endif %}

        {% if arrival_time_str %}
        <div class="result-box" style="background:#e8f5e9; color:#1b5e20; border-color:#a5d6a7;">
            ğŸ›¬ Thá»i gian Ä‘áº¿n dá»± kiáº¿n: {{ arrival_time_str }}
        </div>
        {% endif %}
<script>
function togglePrevFlight() {
    var mode = document.getElementById('mode').value;
    document.getElementById('prev-flight-fields').style.display = (mode === 'prev_flight') ? 'block' : 'none';
}
window.onload = togglePrevFlight;
</script>
{% endblock %}
