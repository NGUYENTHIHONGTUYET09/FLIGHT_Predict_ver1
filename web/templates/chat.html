{% extends "base.html" %}
{% block content %}
<div style="max-width:800px; margin:0 auto;">
    <h2 style="text-align:center; color:#667eea; margin-bottom:8px;">üí¨ FlightBot - Chatbot h·ªó tr·ª£</h2>
    <div style="text-align:center; color:#666; margin-bottom:24px;">
        Xin ch√†o {{ user.name if user else 'Kh√°ch' }}! T√¥i l√† tr·ª£ l√Ω ·∫£o, s·∫µn s√†ng gi√∫p b·∫°n v·ªÅ d·ª± ƒëo√°n chuy·∫øn bay ‚úàÔ∏è
    </div>
    
    <!-- Chat Container -->
    <div style="background:#fff; border-radius:16px; box-shadow:0 4px 24px rgba(0,0,0,0.08); margin-bottom:16px; height:400px; overflow-y:auto; padding:16px;" id="chatContainer">
        {% if chat_history %}
            {% for msg in chat_history %}
                {% if msg.sender == 'user' %}
                <!-- User Message -->
                <div style="display:flex; justify-content:flex-end; margin-bottom:12px;">
                    <div style="background:#667eea; color:#fff; padding:12px 16px; border-radius:18px 18px 4px 18px; max-width:70%; word-wrap:break-word;">
                        <div style="font-size:14px; font-weight:500;">{{ msg.text }}</div>
                        <div style="font-size:11px; opacity:0.8; margin-top:4px;">{{ msg.timestamp }}</div>
                    </div>
                    <div style="width:32px; height:32px; border-radius:50%; background:#667eea; margin-left:8px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:14px;">
                        üë§
                    </div>
                </div>
                {% else %}
                <!-- Bot Message -->
                <div style="display:flex; justify-content:flex-start; margin-bottom:12px;">
                    <div style="width:32px; height:32px; border-radius:50%; background:#4CAF50; margin-right:8px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:14px;">
                        ü§ñ
                    </div>
                    <div style="background:#f5f5f5; color:#333; padding:12px 16px; border-radius:18px 18px 18px 4px; max-width:70%; word-wrap:break-word;">
                        <div style="font-weight:500; color:#4CAF50; font-size:12px; margin-bottom:4px;">FlightBot</div>
                        <div style="font-size:14px; line-height:1.4; white-space:pre-line;">{{ msg.text }}</div>
                        <div style="font-size:11px; color:#666; margin-top:4px;">{{ msg.timestamp }}</div>
                    </div>
                </div>
                {% endif %}
            {% endfor %}
        {% else %}
        <!-- Welcome Message -->
        <div style="display:flex; justify-content:flex-start; margin-bottom:12px;">
            <div style="width:32px; height:32px; border-radius:50%; background:#4CAF50; margin-right:8px; display:flex; align-items:center; justify-content:center; color:#fff; font-size:14px;">
                ü§ñ
            </div>
            <div style="background:#f5f5f5; color:#333; padding:12px 16px; border-radius:18px 18px 18px 4px; max-width:70%;">
                <div style="font-weight:500; color:#4CAF50; font-size:12px; margin-bottom:4px;">FlightBot</div>
                <div style="font-size:14px; line-height:1.4;">
                    üëã Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p b·∫°n v·ªÅ:<br>
                    ‚Ä¢ C√°ch s·ª≠ d·ª•ng d·ª± ƒëo√°n chuy·∫øn bay<br>
                    ‚Ä¢ ƒêƒÉng nh·∫≠p v√† ƒëƒÉng k√Ω<br>
                    ‚Ä¢ Th√¥ng tin v·ªÅ thu·∫≠t to√°n ML<br>
                    ‚Ä¢ B·∫£o m·∫≠t v√† ƒë·ªô ch√≠nh x√°c<br><br>
                    H√£y g√µ c√¢u h·ªèi c·ªßa b·∫°n! üòä
                </div>
            </div>
        </div>
        {% endif %}
    </div>
    
    <!-- Chat Input -->
    <form method="POST" style="display:flex; gap:8px;">
        <input type="text" name="message" required 
               style="flex:1; padding:12px 16px; border:2px solid #e1e5e9; border-radius:24px; font-size:14px; outline:none; transition:border-color 0.3s;" 
               placeholder="Nh·∫≠p c√¢u h·ªèi c·ªßa b·∫°n..." 
               onkeypress="if(event.keyCode==13 && !event.shiftKey) {event.preventDefault(); this.form.submit();}">
        <button type="submit" 
                style="background:#667eea; color:#fff; border:none; border-radius:50%; width:48px; height:48px; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:background-color 0.3s;"
                onmouseover="this.style.backgroundColor='#5a67d8'" 
                onmouseout="this.style.backgroundColor='#667eea'">
            ‚úàÔ∏è
        </button>
    </form>
    
    <!-- Quick Questions -->
    <div style="margin-top:16px; text-align:center;">
        <div style="color:#666; font-size:12px; margin-bottom:8px;">C√¢u h·ªèi nhanh:</div>
        <div style="display:flex; gap:8px; justify-content:center; flex-wrap:wrap;">
            <button onclick="sendQuickMessage('C√°ch d·ª± ƒëo√°n chuy·∫øn bay?')" style="background:#f0f2f5; border:1px solid #ddd; border-radius:16px; padding:6px 12px; font-size:12px; cursor:pointer; color:#333;">
                C√°ch d·ª± ƒëo√°n?
            </button>
            <button onclick="sendQuickMessage('Thu·∫≠t to√°n g√¨?')" style="background:#f0f2f5; border:1px solid #ddd; border-radius:16px; padding:6px 12px; font-size:12px; cursor:pointer; color:#333;">
                Thu·∫≠t to√°n?
            </button>
            <button onclick="sendQuickMessage('ƒê·ªô ch√≠nh x√°c bao nhi√™u?')" style="background:#f0f2f5; border:1px solid #ddd; border-radius:16px; padding:6px 12px; font-size:12px; cursor:pointer; color:#333;">
                ƒê·ªô ch√≠nh x√°c?
            </button>
            <button onclick="sendQuickMessage('Help')" style="background:#f0f2f5; border:1px solid #ddd; border-radius:16px; padding:6px 12px; font-size:12px; cursor:pointer; color:#333;">
                H·ªó tr·ª£
            </button>
        </div>
    </div>
</div>

<script>
function sendQuickMessage(message) {
    document.querySelector('input[name="message"]').value = message;
    document.querySelector('form').submit();
}

// Auto scroll to bottom
document.getElementById('chatContainer').scrollTop = document.getElementById('chatContainer').scrollHeight;
</script>
{% endblock %}
